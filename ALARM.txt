УЯЗВИМОСТИ БЕЗОПАСНОСТИ WINGS
=============================

КРИТИЧЕСКИЕ:
=============

1. ПАРОЛИ ХРАНЯТСЯ В ОТКРЫТОМ ВИДЕ
   Файл: /var/lib/pterodactyl/passwords/{username}.txt
   - Любой с доступом к файловой системе может прочитать все пароли FTP
   - Нет хеширования, нет шифрования
   - Полная компрометация учетных данных
   
2. ОТСУТСТВУЕТ АВТОРИЗАЦИЯ НА API
   Файл: router/router.go (строка 43-45)
   - /download/backup, /download/file, /upload/file работают БЕЗ авторизации
   - Используются только подписанные URL, но можно попробовать обойти
   - Потенциальная утечка данных резервных копий и файлов
   
3. ОТСУТСТВУЕТ ЗАЩИТА ОТ ПЕРЕБОРА ПАРОЛЕЙ В FTP
   - Неограниченное количество попыток авторизации
   - Нет блокировки IP после N неудачных попыток
   - Нет задержки между попытками
   - Возможен полный перебор паролей

4. ОТСУТСТВУЕТ ШИФРОВАНИЕ ТРАФИКА FTP
   - Пароли передаются в открытом виде по сети
   - Уязвимость для MITM атак
   - Перехват учетных данных на сетевом уровне

5. НЕТ ПРОВЕРКИ ПРАВ ДОСТУПА ПОЛЬЗОВАТЕЛЯ К СЕРВЕРУ В FTP
   - Пользователь может получить доступ к любому серверу зная его ID
   - Нет проверки: имеет ли пользователь право на доступ к этому серверу
   - Утечка данных между серверами клиентов

6. ОТСУТСТВУЕТ ЛОГИРОВАНИЕ ОПЕРАЦИЙ С ФАЙЛАМИ
   - Никто не знает: кто, когда, какие файлы скачал/загрузил/удалил
   - Невозможна судебно-медицинская экспертиза при взломе
   - Нет аудита действий пользователей


ВЫСОКИЙ УРОВЕНЬ:
=================

7. CORS КОНФИГУРАЦИЯ ПОТЕНЦИАЛЬНО ОПАСНА
   Файл: router/middleware/middleware.go (строки 121-129)
   - Если origins содержит "*", то любой сайт может делать запросы
   - Используется location из конфига как CORS origin
   - Возможны CSRF атаки

8. ОТСУТСТВУЕТ ПРОВЕРКА ТИПА СОДЕРЖИМОГО
   Файл: router/download.go
   - При загрузке резервных копий не проверяется Content-Type
   - Можно загрузить вредоносный файл вместо бэкапа

9. НЕДОСТАТОЧНАЯ ВАЛИДАЦИЯ ПУТИ К ФАЙЛУ
   Файл: ftp/driver.go функция buildPath()
   - filepath.Clean может быть обойден специальными символами
   - Уязвимость Directory Traversal: можно получить доступ к файлам вне сервера
   - Нет белого списка разрешенных путей

10. ОТСУТСТВУЕТ ЛИМИТ НА РАЗМЕР ЗАГРУЖАЕМЫХ ФАЙЛОВ
    - Можно заполнить диск бесконечной загрузкой
    - DoS атака через исчерпание дискового пространства

11. НЕТ ЗАЩИТЫ ОТ МАСШТАБИРУЕМЫХ АТАК НА API
    - /api/servers можно запросить без лимита
    - /api/servers/:server/logs может быть спамлен
    - Нет rate limiting на уровне API

12. ОТСУТСТВУЕТ ПРОВЕРКА ПРАВ В ФАЙЛОВЫХ ОПЕРАЦИЯХ
    - Только флаг ReadOnly, больше никаких прав
    - Нет granular permissions (кто может что делать)
    - Пользователь может удалить все файлы сервера

13. НЕТ СЕССИОННОГО TIMEOUT ДЛЯ FTP
    - Соединение может оставаться открытым бесконечно
    - Ресурсное истощение (исчерпание сокетов)

14. УЯЗВИМОСТЬ: ПОЛУЧЕНИЕ ИНФОРМАЦИИ О СЕРВЕРАХ
    - Через WebSocket (/api/servers/:server/ws) можно получить много информации
    - Нет проверки на частые запросы
    - Информация раскрывает конфигурацию серверов


СРЕДНИЙ УРОВЕНЬ:
=================

15. ПАРОЛИ ХРАНЯТСЯ БЕЗ ШИФРОВАНИЯ
    - Если скомпрометирована система, все пароли украдены
    - Нет ключа шифрования, нет master key

16. ПРЕДСКАЗУЕМЫЙ ФОРМАТ USERNAME
    - Формат: user_{serverid}
    - Server ID это первые 8 символов UUID
    - Можно перебрать все возможные комбинации

17. ОТСУТСТВУЕТ ВАЛИДАЦИЯ ВХОДНЫХ ДАННЫХ
    - Команды сервера могут содержать спецсимволы
    - Возможна инъекция команд в /api/servers/:server/commands

18. НЕТ ЗАЩИТЫ ОТ SYMLINK АТАК
    - Можно создать symlink и получить доступ к другим файлам
    - ftp/driver.go не проверяет symlinks

19. ИНФОРМАЦИЯ ОБ ОШИБКАХ СЛИШКОМ ПОДРОБНА
    - Раскрываются пути к файлам
    - Раскрывается структура приложения
    - Помогает攻击者в reconnaissance


НИЗКИЙ УРОВЕНЬ:
================

20. НЕТ ШИФРОВАНИЯ КОНФИГУРАЦИОННОГО ФАЙЛА
    - Token хранится в открытом виде в config.yml
    - Уязвимость к физическому доступу

21. ОТСУТСТВУЕТ ДВУХФАКТОРНАЯ АУТЕНТИФИКАЦИЯ
    - Только токен для аутентификации
    - Компрометация токена = полный доступ

22. НЕТ ВЕРСИОНИРОВАНИЯ API
    - Невозможно выключить старые уязвимые версии


СКРЫТЫЕ МЕТОДЫ И ПОТЕНЦИАЛЬНЫЕ ЛАЗЕЙКИ:
=========================================

23. ОТСУТСТВУЕТ ЯВНОЕ ОТКЛЮЧЕНИЕ ОПАСНЫХ ОПЕРАЦИЙ
    - DELETE /api/servers/:server может удалить сервер
    - Нет подтверждения, нет 2FA
    - Возможно случайное удаление через компрометированный токен

24. WEBSOCKET ПОДКЛЮЧЕНИЯ НЕ ПРОВЕРЯЮТ ИСТОЧНИК
    - /api/servers/:server/ws использует JWT но нет проверки источника
    - CSRF атака на WebSocket

25. РЕЗЕРВНЫЕ КОПИИ МОГУТ СОДЕРЖАТЬ ЧУВСТВИТЕЛЬНЫЕ ДАННЫЕ
    - Нет шифрования резервных копий
    - Утечка данных при компрометации хранилища бэкапов


РЕКОМЕНДУЕМЫЙ ПОРЯДОК ИСПРАВЛЕНИЯ:
===================================

КРИТИЧЕСКИЕ (исправить НЕМЕДЛЕННО):
1. Добавить авторизацию на /download/* и /upload/* endpoints
2. Добавить rate limiting на FTP и API (макс 5 попыток за минуту)
3. Добавить шифрование паролей (bcrypt/argon2)
4. Добавить проверку прав доступа пользователя к серверу
5. Добавить защиту от Directory Traversal (проверка symlinks)

ВЫСОКИЕ (исправить в спринте):
6. Добавить лимиты размера файлов
7. Добавить rate limiting на все API endpoints
8. Добавить audit logging всех операций
9. Реализовать granular permissions для файловых операций
10. Добавить session timeout для FTP

СРЕДНИЕ (исправить в течение месяца):
11. Шифровать пароли при хранении
12. Добавить валидацию команд (injection protection)
13. Добавить CORS protection (убрать wildcards)
14. Реализовать 2FA для критических операций
15. Добавить версионирование API
